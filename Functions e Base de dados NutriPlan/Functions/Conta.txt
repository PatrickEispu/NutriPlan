CREATE OR REPLACE FUNCTION criar_conta(
    p_nm_nome VARCHAR,
    p_ds_email VARCHAR,
    p_ds_senha VARCHAR,
    p_fk_nr_id_tipo_conta INT
)
RETURNS INT AS $$
DECLARE
    new_id INT;
BEGIN
    INSERT INTO conta (nm_nome, ds_email, ds_senha, fk_nr_id_tipo_conta)
    VALUES (p_nm_nome, p_ds_email, p_ds_senha, p_fk_nr_id_tipo_conta)
    RETURNING nr_id_conta INTO new_id;
    RETURN new_id;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION buscar_conta_por_id(
    p_nr_id_conta INT
)
RETURNS TABLE(
    nr_id_conta INT,
    nm_nome VARCHAR,
    ds_email VARCHAR,
    ds_senha VARCHAR,
    fk_nr_id_tipo_conta INT
) AS $$
BEGIN
    RETURN QUERY
    SELECT nr_id_conta, nm_nome, ds_email, ds_senha, fk_nr_id_tipo_conta
    FROM conta
    WHERE nr_id_conta = p_nr_id_conta;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION verificar_email_existente(p_email VARCHAR)
RETURNS BOOLEAN AS $$
DECLARE
    email_existente BOOLEAN;
BEGIN
    SELECT EXISTS (
        SELECT 1
        FROM conta
        WHERE email = p_email
    ) INTO email_existente;

    RETURN email_existente;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION public.buscar_id_conta_por_email(email character varying)
 RETURNS integer
 LANGUAGE plpgsql
AS $function$
DECLARE
    id_conta INT;
BEGIN
    SELECT nr_id_conta INTO id_conta
    FROM conta
    WHERE ds_email = email;

    RETURN id_conta;
END;
$function$
;

CREATE OR REPLACE FUNCTION atualizar_conta(
    p_nr_id_conta INT,
    p_nm_nome VARCHAR,
    p_ds_email VARCHAR,
    p_ds_senha VARCHAR,
    p_fk_nr_id_tipo_conta INT
)
RETURNS VOID AS $$
BEGIN
    UPDATE conta
    SET nm_nome = p_nm_nome, ds_email = p_ds_email, ds_senha = p_ds_senha, fk_nr_id_tipo_conta = p_fk_nr_id_tipo_conta
    WHERE nr_id_conta = p_nr_id_conta;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION atualizar_conta(
    p_nr_id_conta INT,
    p_nm_nome VARCHAR,
    p_ds_email VARCHAR,
    p_ds_senha VARCHAR,
    p_fk_nr_id_tipo_conta INT
)
RETURNS VOID AS $$
BEGIN
    UPDATE conta
    SET nm_nome = p_nm_nome, ds_email = p_ds_email, ds_senha = p_ds_senha, fk_nr_id_tipo_conta = p_fk_nr_id_tipo_conta
    WHERE nr_id_conta = p_nr_id_conta;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION deletar_conta(
    p_nr_id_conta INT
)
RETURNS VOID AS $$
BEGIN
    DELETE FROM conta WHERE nr_id_conta = p_nr_id_conta;
END;
$$ LANGUAGE plpgsql;





